// deprecated

(() => {
  /**
   * Check and set a global guard variable.
   * If this content script is injected into the same page again,
   * it will do nothing next time.
   */
  if (window.hasRun) {
    return;
  }
  window.hasRun = true;

	let permission;
	Notification.requestPermission().then(result => {
		permission = result
		// document.getElementById("notifPerms").style.display = "none"
	});

  // indices are strings
  function scrapeOptions(indices){
	let data = {}

	Array.from(document.querySelectorAll("select[name='new_index_nmbr']>option"))
		.filter(e => indices.includes(`${e.value}`)) // list of elems
		.forEach(e => {
			data[e.value] = parseInt(e.innerText.split("/")[1].trim()) // index : slots
		})

	return data
  }

  function selectIndex(data, indices){
	for (const i of indices){
		if (data[i] > 0){
			return i
		}
	}
	console.log("this iteration's search failed...")
	return undefined
  }

  /**
   * Listen for messages from the background script.
   * Call "insertBeast()" or "removeExistingBeasts()".
   */
  browser.runtime.onMessage.addListener((message) => {
    if (message.command === "check") {
		location.reload()
		let data = scrapeOptions(message.indices)
		let result = selectIndex(data, message.indices)
		if (result !== undefined){
			new Notification('Course index found!',{
				body: `${i} with ${data[i]} slots left`
			});

			document.querySelector("select[name='new_index_nmbr']").value = result
		}
    } else if (message.command === "reset") {

    }
  });
})();